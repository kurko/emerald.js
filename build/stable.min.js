function emeraldActionController(){this.extend=function(e){var t=this;return t.properties=e,new emeraldActionControllerInstance(e)}}function emeraldActionControllerInstance(e){var t=function(){this.self=function(e){this.properties=e;for(propertyName in e)this[propertyName]||(this[propertyName]=e[propertyName]);return this},this.params=function(e){var t=new Object;for(i=0;i<e.length;i++){var n=e[i];t[n.name]=n.value}return t},this.persistView=!0,this.persistViewCallback=function(e){debugger;return this.persistView&&Emerald.modelObserver.update(e),!0}},n=(new t).self(e);return n}function emeraldActiveModel(){this.extend=function(e){var t=this;return t.properties=e,new emeraldActiveModelInstance(e)}}function emeraldActiveModelInstance(e){function n(e,t){for(attribute in t)e.prototype[t[attribute]]=null}var t=function(){this.self=function(e){return this.properties=e,this},this.attributes=function(){attributesValues={};if(this.properties.attrAccessible){var e=this.properties.attrAccessible;for(attribute in e){var t=e[attribute];this[t]&&(attributesValues[t]=this[t])}}return attributesValues},this.route=function(){return this.properties.route},this.get=function(e){return this.properties[e]?this.properties[e]:"none"},this.save=function(e,t){debugger;var n=(new emeraldPersistence(this)).save(e,t);return n}},r=(new t).self(e);return n(t,e.attrAccessible),r}function modelObserver(){}function emeraldPersistence(e){var t=function(){this.initialize=function(e,t){return this.model=e,this._class=t,this},this.save=function(e,t){return(new this._class.PersistenceSave).save(e,t)}};this.PersistenceSave=function(){var t=function(){this.initialize=function(e,t){return this.model=e,this._class=t,this},this.save=function(e,t){var n=e,r=t,i={url:this.model.route(),data:n,type:this.requestType(n),dataType:"json"};return $.ajax(i).done(function(e){debugger;r&&r.persistViewCallback(e)}).fail(function(e){r&&r.persistViewCallback(JSON)}),i},this.requestType=function(e){return e.id?"PUT":"POST"}},n=(new t).initialize(e,this);return n};var n=(new t).initialize(e,this);return n}var Emerald={Core:{},ActionView:{Elements:{},Events:{}}};Emerald.ActionView.extend=function(e){var t=new Object,n=this;n.actions=e,n.actions.initialize&&$(document).ready(function(){n.actions.initialize()}),$(document).ready(function(){Emerald.ActionView.Elements.bindToView(),Emerald.ActionView.Events.bindElementToViewAction(n.actions)});for(action in e)t[action]=e[action];return t},Emerald.ActionView.Elements.bindToView=function(){$("[data-view-action]").each(function(e,t){var n=$(this).closest("[data-view]").data("view");t.setAttribute("extendsView",n)})},Emerald.ActionView.Elements.dataFieldsSelector=function(){var e="";return e+="input[type='text'], ",e+="input[type='radio']:checked",e},Emerald.ActionView.Elements.dataFields=function(){var e=this.dataFieldsSelector();return $(e)},Emerald.ActionView.Events.bindElementToViewAction=function(e){$("[data-view-action]").each(function(t,n){var r=n.getAttribute("data-event"),i=n.getAttribute("data-view-action");r=Emerald.ActionView.Events.defineDefaultEvent(n,r);var s="";s+="input[type='text'][data-view-action='"+i+"'], ",s+="input[type='radio'][data-view-action='"+i+"']:checked",$(this).on(r,function(t){var n=$(s);e[i](t,n)})})},Emerald.ActionView.Events.defineDefaultEvent=function(e,t){return t?t:"keyup"},Emerald.modelObserver=new modelObserver,modelObserver.prototype.update=function(e){$("[data-observe]").each(function(t){var n=$(this).data("observe"),r=n.split("."),i=e;$.each(r,function(e,t){if(!i[t]&&typeof i[t]!="string")return!1;i=i[t]});switch(typeof i){case"number":case"bool":case"string":return $(this).html(i),!0}})};