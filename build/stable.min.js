var Emerald={Version:"0.0.1",Core:{},Controller:{},ActionView:{Elements:{},Events:{}},Model:{}};Emerald.ActionView.extend=function(e){var t=new Object,n=this;n.actions=e,n.actions.initialize&&$(document).ready(function(){n.actions.initialize()}),$(document).ready(function(){Emerald.ActionView.Elements.bindToView(),Emerald.ActionView.Events.bindElementToViewAction(n.actions)});for(action in e)t[action]=e[action];return t},Emerald.ActionView.Elements.bindToView=function(){$("[data-view-action]").each(function(e,t){var n=$(this).closest("[data-view]").data("view");t.setAttribute("extendsView",n)})},Emerald.ActionView.Elements.dataFieldsSelector=function(){var e="";return e+="input[type='text'], ",e+="input[type='radio']:checked",e},Emerald.ActionView.Elements.dataFields=function(){var e=this.dataFieldsSelector();return $(e)},Emerald.ActionView.Events.bindElementToViewAction=function(e){$("[data-view-action]").each(function(t,n){var r=n.getAttribute("data-event"),i=n.getAttribute("data-view-action");r=Emerald.ActionView.Events.defineDefaultEvent(n,r);var s="";s+="input[type='text'][data-view-action='"+i+"'], ",s+="input[type='radio'][data-view-action='"+i+"']:checked",$(this).on(r,function(t){var n=$(s);e[i](t,n)})})},Emerald.ActionView.Events.defineDefaultEvent=function(e,t){return t?t:"keyup"},Emerald.Controller.extend=function(e){var t=new Object,n=this;n.actions=e;for(action in e)t[action]=e[action];return t.params=function(e){var t=new Object;for(i=0;i<e.length;i++){var n=e[i];t[n.name]=n.value}return t},t.persistView=!0,t.afterAjaxResponseSuccessCallback=function(e,t){return t||(t=Emerald.Model.Observer),this.persistView&&t.update(e),!0},t.failedAjaxResponseCallback=function(e){if(typeof observerObject=="undefined"||!observerObject)observerObject=Emerald.Model.Observer;observerObject.update(e)},t},Emerald.Model.extend=function(e){var t=new Object,n=this;this.properties=e;for(property in e)t[property]=e[property];return this.properties.initialize&&$(document).ready(function(){n.properties.initialize()}),Emerald.Model.Attributes.initAttrAccessible(t,e.attrAccessible),t.get=function(e){return n.properties[e]?n.properties[e]:null},t.update=function(e){for(i=0;i<e.length;i++){var t=e[i];this[t.name]=t.value}return this},t.save=function(e,t){return t||(t=Emerald.Persistence),(new t(this)).save(e)},t},Emerald.Model.Attributes={},Emerald.Model.Attributes.initAttrAccessible=function(e,t){e.attributes=function(){return!1};if(!t)return!1;var n=t;for(attribute in n){var r=n[attribute];e[r]||(e[r]=""),e.attributes=function(t){var n=Emerald.Model.Attributes.getAttributes(e);return t?n[t]:n}}return!0},Emerald.Model.Attributes.getAttributes=function(e){var t={};if(!e.attrAccessible)return t;var n=e.attrAccessible;for(attribute in n){var r=n[attribute];t[r]=e[r]}return t},Emerald.Model.Observer={update:function(e){return $("[data-observe]").each(function(t){var n=$(this).data("observe"),r=n.split("."),i=e;$.each(r,function(e,t){if(!i[t]&&typeof i[t]!="string")return!1;i=i[t]});switch(typeof i){case"number":case"bool":case"string":return $(this).html(i),!0}}),!0}},Emerald.Persistence=function(e,t){var n=new Object;return t||(t=Emerald.Persistence),n.model=e,n.save=function(e){return t.save(n.model,e)},n},Emerald.Persistence.save=function(e,t){var n=function(){return this.initialize=function(e){return this.model=e,this},this.save=function(e,t){var n=this.model.attributes();if(!n)return!1;var r=t,i=Emerald.Persistence.saveRequest(e);return $.ajax(i).done(function(e){r&&r.afterAjaxResponseSuccessCallback(e)}).fail(function(e){r&&r.failedAjaxResponseCallback($.parseJSON(e.responseText))}),i},this};return n().initialize(e),n().save(e,t)},Emerald.Persistence.saveRequest=function(e){var t=e.attributes();return{url:e.route,data:t,type:Emerald.Persistence.saveRequestType(t),dataType:"json"}},Emerald.Persistence.saveRequestType=function(e){return e.id?"PUT":"POST"};